<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="boardMapper">
  	 <select id="selectListCount"
  	 			resultType="_int">
  	 	SELECT
  	 	       COUNT(*)
  	 	  FROM
  	 	       KH_BOARD
  	 	 WHERE
  	 	       STATUS ='Y'
  	 	   AND
  	 	       BOARD_TYPE = 1
  	</select>
  	<select id="selectBoardList"
  			parameterType="com.kh.java.common.vo.PageInfo"
  			resultType="com.kh.java.board.model.vo.Board">
  		SELECT
  			   BOARD_NO boardNo
  			 , CATEGORY_NAME categoryName
  			 , USER_NAME boardWriter
  			 , BOARD_CONTENT boardTitle
  			 , CREATE_DATE creteDate
  			 , COUNT
  		  FROM 
  		       KH_BOARD
  		  JOIN
  		        KH_CATEGORY USING(CATEGORY_NO)
  		  JOIN 
  		         KH_MEMBER ON (BOARD_WRITER = USER_NO)	
  		 WHERE
  		        KH_BOARD.STATUS='Y'
  		   AND
  		        BOARD_TYPE=1
		  ORDER
		     BY
		        BOARD_NO DESC
		  OFFSET
		         #{offset} ROWS FETCH NEXT #{boardLimit} ROWS ONLY
  	</select>
  	
  	<select id="selectCategory"
  			resultType="com.kh.java.board.model.vo.Category">
  		SELECT
  		       CATEGORY_NO categoryNo
  		     , CATEGORY_NAME categotyName
  		  FROM
  		  		KH_CATEGORY
  		  ORDER
 			 BY
 			    CATEGORY_NO ASC	 		   
  	</select>
  	<!-- selectKey 
  	게시글 +첨부파일 INSERT
  	주문 + 주문상세 INSERT
  	회원 + 권한 INSERT -->
  	<insert id="insertBoard"
  			parameterType="com.kh.java.board.model.vo.Board">
  		<selectKey resultType="long" keyProperty="baordNO"
  					order="BEFORE">
  			SELECT SEQ_BNO.NEXTVAL FROM DUAL
  		</selectKey>
  		INSERT
  		  INTO
  		       KH_BOARD
  		       (
  		        BOARD_NO
  		      , BOARD_TYPE
  		      , CATEGORY_NO
  		      , BOARD_TITLE
  		      , BOARD_CONTENT
  		      , BOARD_WRITER
  		       )
  		  VALUES
  		  		(
  		  		#{boardNo}
  		      , 1
  		      , #{category}
  		      , #{boardTitle}
  		      , #{boardContent}
  		      , #{boardWriter}
  		  		)
  	</insert>
  	
  	<insert id="insertAttachment"
  			parameterType="com.kh.java.board.model.vo.Attachment">
  			INSERT
  			  INTO
  			       KH_ATTACHMENT
  			       (
  			       FILE_NO
  			     , REF_BNO
  			     , ORIGIN_NAME
  			     , CHANGE_NAME
  			     , FILE_PATH
  			       )
  			 VALUES
  			 		(
  			 		SEQ_FNO.NEXTVAL
  			 	  , #{refBno}
  			 	  , #{orifinName}
  			 	  , #{changeName}
  			 	  , #{filePath}
  			 		)
  	</insert>
  	<insert id="insertBoard2"
  			parameterType="com.kh.java.board.model.vo.Board">
  		<selectKey resultType="long" keyProperty="baordNO"
  					order="BEFORE">
  			SELECT SEQ_BNO.NEXTVAL FROM DUAL
  		</selectKey>
  		INSERT
  		  INTO
  		       KH_BOARD
  		       (
  		        BOARD_NO
  		      , BOARD_TYPE
  		      , CATEGORY_NO
  		      , BOARD_TITLE
  		      , BOARD_CONTENT
  		      , BOARD_WRITER
  		       )
  		  VALUES
  		  		(
  		  		SEQ_BNO.NEXTVAL
  		      , 1
  		      , #{category}
  		      , #{boardTitle}
  		      , #{boardContent}
  		      , #{boardWriter}
  		  		)
  		 RETURNING
  		           BOARD_NO
  		      INTO
  		           #{boardNo}
  	</insert>
  	
  	<update id="increaseCount"
  			parameterType="_int">
  		UPDATE
  		      KH_BOARD
  		   SET
  		       COUNT =  COUNT +1
  		  WHERE
  		        BOARD_NO = #{boardNo}
  		    AND
  		        STATUS = 'Y'
  	</update>
  	<select id="selectBoard"
  			resultType="com.kh.java.board.model.vo.Board"
  			parameterType="_int">
  		SELECT
  		       BOARD_NO boardNo
  		     , USER_NAME boardWriter
  		     , CATEGORY_NAME category
  		     , BOARD_TITLE boardTitle
  		     , BOARD_CONTENT boardContent
  		  FROM
  		       KH_BOARD
  		  JOIN
  		       KH_CATEGORY USING(CATEGORY_NO)
  		  JOIN 
  		       KH_MEMBER ON (BOARD_WRITER =USER_NO)
  		 WHERE
  		       KH_BOARD.STATUS = 'Y'
  		   AND
  		       BOARD_NO = #{boardNo}
  	</select>
  	
  	<select id="selectAttachment"
  			resultType="com.kh.java.board.model.vo.Attachment"
  			parameterType="_int">
  		SELECT
  		       FILE_NO fileNo
  		     , ORIGIN_NAME originName
  		     , CHANGE_NAME changeName
  		     , FILE_PATH filePath
  		  FROM
  		       KH_ATTACHMENT
  		  WHERE
  		        STATUE = 'Y'
  		    AND
  		      	REF_BNO =#{boardNo}
  	</select>	
  	<select  id="selectBoardWriter"
  				resultType="long">
  		SELECT
  		       BOARD_WRITER
  		  FROM 
  		        KH_BOARD
  		 WHERE
  		        BOARD_NO=#{boardNo}
  	
  	
  	
  	
  	</select>	 	      
  
  	
  
  
  </mapper>